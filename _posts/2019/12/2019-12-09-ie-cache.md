---
title: '프론트엔드 개발환경의 이해: NPM'
layout: post
summary: ''
category: series
tags: 
---

몇 년 전부터 프론트엔드 개발자 구인 공고에 Node.js 기술이 우대 사항의 항목 중 하나로 추가 되었다. Node.js는 백엔드를 구현하는 기술이라고 생각했다면 이 항목이 의문일지 모르겠다. 브라우져에서 동작하는 웹어플리케이션에 Node.js 기술이 직접 들어가 있는것은 아니다. 하지만 이것을 만드는 개발 환경에 Node.js를 모르고서는 제대로 개발하기가 어렵다.

## 1. 프론트엔드에 노드js가 필요한 이유

자바스크립트 스펙의 빠른 발전에 비해 브라우져의 지원 속도는 매번 뒤쳐진다. 아무리 편리한 스펙이 나오더라도 이것을 변환해 주는 도구, 이를테면 바벨의 도움 없이는 부족하다. 

하지만 바벨만으로 충분할까? 그렇지 않다고 생각한다. 웹팩, NPM같은 노드 기술로 만들어진 도구들과 함께 사용해야 비로소 자동화되어 빠르게 개발할 수 있다.

마찬가지로 Typescript, SASS 같은 고수준 프로그래밍 언어를 사용하려면 전용 트랜스파일러가 필요함은 물론, Node.js 환경이 뒷받침 되어야하는 것이 지금의 프론트엔드 개발 환경이다. 

과거처럼 코딩 결과물을 바로 브라우져에 올리는 경우는 갈수록 줄어든다. 파일을 압축하고, 코드를 난독화하고, 폴리필을 추가하는 등 개발 이외의 작업이 필요하다. Node.js는 이러한 일련의 빌드 과정을 자동화 해주는 과정을 구성하는 도구들을 이해하는데 중요한 역할을 한다. 뿐만 아니라 라이브러리 의존성을 해결하고, 각종 테스트를 자동화하는데 그 역할을 확대하고 있다. 

이러한 과정은 각 프레임워크에서 제공하는 도구를 사용하면 쉽게 줄일 수 있다. React.js 개발 환경을 만드는 CRA(create-react-app), Vue.js 개발 환경을 만드는 vue-cli 가 이러한 용도의 도구다. 하지만 개발 프로젝트는 각자의 형편이라는 것이 있어서 오픈소스가 제공하는 툴을 그대로 사용할 수 없는 경우도 빈번하다. 결과물을 수정해야한다면  Node.js 지식이 있어야만 가능하다. 뿐만 아니라 이러한 도구를 제공하지 않는 환경이라면 내가 직접 환경을 구축해야할 상황에 놓일 수도 있다. 

이러한 배경하에 Node.js는 요즘의 프론트엔드 개발에서 필수 기술로 자리매김하고 있다. 이번 연재에서는 Node.js를 이용해 프론트엔드 개발 환경을 이해하고 직접 구성해 보는 내용을 다루겠다.

## 2 Node.js 설치

노드 설치는 무척 간단하다. 본인의 컴퓨터에서 사용하는 운영체제에 맞는 설치파일을 다운받으면 된다. [Nodejs.org 사이트](https://nodejs.org/ko/)에서 노드 최신 버전을 설치하자. 

두 가지 버전을 선택하여 설치할 수 있다. 왼쪽 짝수 버전, 오른쪽이 홀수 버전이다. 안정적이고 장기간 지원하는 것이 짝수 버전이고, 그 보다 불안정할 수 있지만 최신 기능을 지원하는 것이 홀수 버전이다. 리눅스 배포버전과 비슷한 관례를 따른다.

* 짝수 버전: 안정적, 신뢰도 높음 (LTS)
* 홀수 버전: 최신 기능

이왕이면 오른쪽에 있는 최신 버전을 선택해서 다운받자. 개발환경이니깐 말이다. (만약 Node.js로 서버를 구성하는 경우라면 어떤 버전을 사용할지 신중하게 선택해야 한다)

![Node.js 다운로드](/assets/imgs/2019/12/09/nodejs-download.jpg)

다운로드를 완료하고 파일을 실행하면 노드 설치를 진행할 수 있다.

![Node.js 설치](/assets/imgs/2019/12/09/nodejs-install.jpg)

버튼을 몇 번 클릭하면 아래 경로에 Node.js 와 Npm이 설치된다. (운영체제에 따라 경로는 다를 수 있다)

* Node.js: /usr/local/bin/node
* Npm: /usr/local/bin/npm

설치를 마친뒤 터미널을 열어 각 명령어를 확인해 보자. 먼저 Node.js부터 실행한다.

```
$ node
> 1 + 2
3
```

`>` 문자가 나오고 입력을 대기하는 화면이 나온다. 정수를 계산하는 짧은 문장을 입력하면 결과 3을 출력한다. 

이것을 노드 REPL(read-eval-print loop)이라고 부르는데, 자바스크립트 코드를 입력하고 즉시 결과를 확인할 수 있는 프로그램이다. 파이썬이나 PHP 같은 다른 언어도 제공하는 기능 중의 하나이다.

.exit 명령을 실행하거나 ctrl+c를 연속 두 번 입력하면 REPL 프로그램에서 빠져 나올 수 있다.

이번에는 `--version` 옵션을 추가해 설치한 노드 버전을 확인해 보자.

```
$ node --version
v13.1.0
```

NPM(Node Package Manage) 명령어도 확인해 보겠다.

```
$ npm
Usage: npm <command>
```

보통 터미널 툴 처럼 사용방법(Usage)을 알려주고 종료한다. 자세한 사용법은 좀 이따 다룰테니 지금은 제대로 설치 되었는지 버전 정보만 확인해 보겠다.

```
$ npm --version
6.12.1
```

Node.js 13 버전과  Npm 6 버전이 각 각 설치된 것을 확인했다.

## 3. 프로젝트 초기화
대부분의 개발 프로젝트에는 코드 작성 뿐만이 아니라 사용하는 라이브러리를 다운로드하고 빌드하는 등 일련의 명령어를 자동화하여 프로젝트를 관리하는 도구가 존재한다. PHP의 컴포져([Composer](https://getcomposer.org/))나 자바의 그래들([Gradle](https://gradle.org/)) 같은 툴이 그러한 프로그램이다. Npm은 자바스크립트를 이용한 프로젝트의 빌드 도구인 셈이다.  Npm을 이용해 프론트엔드 개발 프로젝트를 세팅해 보자. 

### 3.1 INIT

Npm은 다양한 하위 명령어를 제공한다. 그중 init 명령를 사용하면 프로젝트를 생성할 수 있다.

```
$ npm init

package name:
version:
description:
entry point:
test command:
git repository:
keywords:
author:
license:
```

패키지 이름, 버전 등 프로젝트와 관련한 몇 가지 정보를 얻기 위한 질문을 볼 수 있다. 답변하거나 혹은 빈 칸으로 남겨 두면 괄호 안의 기본값을 입력할 수 있다. 모든 질문에 답하면 명령어를 실행한 폴더에 pacakge.json 파일이 생성된다. 모두 기본값을 사용할 것이라면 npm init -y 명령어를 실행하면 질문을 스킵할 수 있다.

### 3.2 PACKAGE.JSON

Node.js는 package.json 파일에 프로젝트의 모든 정보를 기록한다. 여기에 있는 내용을 하나씩 살펴 보자.

* name: 프로젝트 이름
* version: 프로젝트 버전 정보
* description: 프로젝트 설명
* main: 노드 어플리케이션일 경우 진입점 파일명. 프론트엔드 프로젝트일 경우 사용하지 않는다.
* scripts: 프로젝트 명령어를 등록할수 있다.초기화시 test가 샘플로 등록되어 있다
* author: 프로그램 작성자
* license: 라이센스

## 4. 프로젝트 명령어

생성한 프로젝트는 package.json에 등록한 스크립트(scripts)를 이용해 실행한다. 어플리케이션 빌드, 테스트, 배포, 실행 따위의 명령어를 등록하는데 실행하는 방법은 다음과 같다.

```
$ npm test
Error: no test specified
npm ERR! Test failed.  See above for more details.
```

에러 메세지를 출력하고 그 다음 줄에 npm 에러가 발생한다. 이것은 npm 스크립트에 등록된 쉘 스크립트 코드를 실행했기 때문이다.

package.json
```json
{
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  }
}
```

echo 명령어로 메세지 "Error: no test specified" 를 출력한뒤 에러 코드 1을 던지면서 종료하는 동작이다. Npm 명령어로 실행하면 에러 코드 1을 확인하면 npm 에러("npm ERR!...")를 출력한다. 

Npm에서 사용할 수 있는 명령어는 몇개나 될까? Npm 사용법을 확인해 보자.

```
Usage: npm <command>

where <command> is one of:
    access, adduser, audit, bin, bugs, c, cache, ci, cit,
    clean-install, clean-install-test, completion, config,
    create, ddp, dedupe, deprecate, dist-tag, docs, doctor,
    edit, explore, get, help, help-search, hook, i, init,
    install, install-ci-test, install-test, it, link, list, ln,
    login, logout, ls, org, outdated, owner, pack, ping, prefix,
    profile, prune, publish, rb, rebuild, repo, restart, root,
    run, run-script, s, se, search, set, shrinkwrap, star,
    stars, start, stop, t, team, test, token, tst, un,
    uninstall, unpublish, unstar, up, update, v, version, view,
    whoami
```

무척 많다. 보통 사용하는 것들이 start, test, install, uninstall 이다.

* start: 어플리케이션 실행
* test: 테스트 
* install: 패키지 설치
* uninstall: 패키지 삭제

필요하다면 명령어를 추가할 수도 있다. 가령 빌드를 위한 build 스크립트는 package.json의 scripts 부분에 build 키를 추가하고 쉘 스크립트를 문자열로 등록하면 된다.

package.json:
```json
{
  "scripts": {
    "build": "여기에 빌드 스크립트를 등록한다"
  }
}
```

커스텀으로 등록한 명령어는 아래 형식으로 run을 추가해서 실행한다.

```
$ npm run build
```

프론트엔드 개발 환경을 구축하기 위해 추가할 스크립트는 build, lint 정도가 있겠다.

* build: 소스 빌드 
* lint: 소스 컨벤션 검사


## 5 패키지 설치

### 5.1 CDN을 이용한 방법

개발할 때 우리가 직접 작성하는 코드가 아닌, 이미 누군가  만들어 놓은 코드를 가져다 쓰는 것은 무척 자연스러운 일이다. 가장 간단한 방법은 CDN(컨텐츠 전송 네트워크)으로 제공하는 라이브러리를 직접 가져 오는 방식이다. Ajax 라이러리중 많이 사용하는 [axios](https://github.com/axios/axioshttps://github.com/axios/axios)를 가져오려면 직접 주소를 로딩한다.

```html
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
```

CDN 서버가 장애로 접근할수 없다면 어떻게 될까? 아무리 우리 어플리케이션 서버가 정상이더라도 필수 라이브러리를 가져오지 못한다면 웹 어플리케이션은 정상적으로 실행되지 않을 것이다.


### 5.2 직접 다운로드하는 방법

그렇다면 라이브러리 코드를 우리 프로젝트 폴더에 다운르로 받아 놓으면 된다.. CDN을 사용하지 않기 때문에 그 쪽 장애와 독립적으로 웹 어플리케이션을 제공할 수 있을 것이다. 

하지만 이것도 문제가 없는것은 아니다. 라이브러리는 주기적으로 업데이트 버전이 나올 것이고 어딘가에 배포될 것이다. 우리 프로젝트에서도 최신의 라이브러리로 교체해야 하는데 매번 직접 다운로드하는 것은 매우 귀찮은 일이다. 뿐만 아니라 사용한 버전정보를 관리하여 하위 호환 여부까지 확인하려면 실수할 가능성이 적지 않다.

라이브러리를 어느 한 곳에서 관리하고 우리 프로젝트에서는 적당한 버전을 그때그때 다운받아 사용한다면 어떨까? 저장소로부터 직접 다운받아 사용하기 때문에 CDN 서버의 장애와 무관할 것이다.  뿐만 아니라 버전 관리의 부담과 휴먼 에러까지 예방할 수 있을 것 같다.


### 5.3 NPM을 이용한 방법

NPM은 이러한 방식으로 문제를 해결한다. (npm이 고장난다면?) npm install 명령어로 외부 패키지를 우리 프로젝트 폴더에 다운로드한다. Axios를 프로젝트에 추가해 보자. 

```
$ npm install axios
```

위 명령어는 최신 버전의 axios를 [NPM 저장소](https://www.npmjs.com/)에서 찾아 우리 프로젝트로 다운로드 한다. 그리고 package.json 파일에 이 정보를 기록한다.

```json
{
  "dependencies": {
    "axios": "^0.19.0"
  }
}
```

버전 0.19.0을 설치했다는 의미다. 

이렇게 필요한 외부 모듈은 install 명령어를 이용해 중앙 저장소에서 우리 프로젝트 폴더로 다운로드 할 수 있다.


### 5.4 유의적 버전

"^0.19.0" 이 표기는 무슨 뜻일까? 

위 질문에 답하기 전에 버전 관리에 대해서 생각해 보자. 만약 프로젝트에서 사용하는 패키지의 버전을 엄격하게 제한한다면 어떨가? 프로젝트를 버전업 하는데 꽤 힘들 수 있다. 사용하는 패키지가 전부 버전업 되어야 하기 때문이다. 어쩌면 우리 프로젝트는 현재 버전에 갖혀 버릴지도 모른다. 

그럼 프로젝트에서 사용하는 패키지 버전을 느슨하게 풀어 놓으면 문제가 해결될까? 오히려 여러 버전별로  코드를 관리해야하는 혼란스러움을 겪게될수 있다.

그래서 버전 번호를 관리하기 위한 규칙이 필요한데 이 체계를 **"유의적 버전"**이라고 한다. NPM은 이 [유의적 버전(Sementic Version)](https://semver.org/lang/ko/)을 따르는 전제 아래 패키지 버전을 관리한다. 

유의적 버전은 주(Major), 부(Minor), 수(Patch) 세 가지 숫자를 조합해서 버전을 관리한다.
위에 설치한 axios의 버전은 v0.19.0인데 주 버전이 0, 부 버전이 19, 수 버전이 0인 셈이다.

각 버전을 변경하는 기준은 다음과 같다

* 주 버전(Major Version): 기존 버전과 호환되지 않게 변경한 경우
* 부 버전(Minor version): 기존 버전과 호환되면서 기능이 추가된 경우
* 수 버전(Patch version): 기존 버전과 호환되면서 버그를 수정한 경우 

### 5.5 버전의 범위

NPM이 버전을 관리하는 방식은 유의적 버전 명세 뿐만아니라 버전의 범위를 자신만의 규칙으로 관리한다. 가장 단순한 것이 특정 버전을 사용하는 경우다.

```
1.2.3
```

특정 버전보다 높거나 낮을 경우는 다음과 같이 명시한다.

```
>1.2.3
>=1.2.3
<1.2.3
<=1.2.3
```

마지막으로 캐럿(^)과 틸드(~)를 이용해 범위를 명시한다.

```
^1.2.3
~1.2.3
```

**캐럿**은 맨 좌측의 0이 아닌 숫자는 건드리지 않고 업데이트한다. 예를 들어 ^1.2.3 표기는 1.2.3부터 2.0.0 미만 까지를 포함한다. 2.0.0은 포함하지 않는다. 

**틸트**는 맨 우측 숫자 내에서 업데이트 한다. 예를 들어 ~1.2.3 표기는 1.2.3 부터 1.3.0 미만 까지를 포함한다. 1.3.0은 포함하지 않는다. 과거에 npm 이 사용하던 방식이었다.

틸트에서 캐럿으로 변경한 이유는 무엇일까? 초기 정식 릴리즈 전까지  패키지 버전은 수시로 변한다. 0.1에서 0.2로 부버전이 변하더라도 하위 호환성을 지키지 않고 배포하는 경우가 빈번하다. ~0.1로 배포한다면 0.1.0 부터  1.0.0 미만까지 사용하기 때문에 하위 호완성을 지키지 못하는 0.2로도 업데이트 되어버리는 문제가 발생 한다.

반면 캐럿을 사용한다면(^0.1) 0.1.0부터 0.2.0 미만 내에서만 버전업을 하는것이다. 따라서 하위 호완성을 유지할 수 있다. (자세한 내용은 [여기](https://blog.outsider.ne.kr/1041)를 참고)

Npm install 명령으로 패키지를 설치하면 package.json에 설치한 패키지 버전을 기록하는데 캐럿 방식을 이용한다. 그래서 우리가 설치한 axios는 ^0.19.0 버전으로 기록된 것이다. axios는 아직 정식 릴리즈 전이기 때문에 언젠가 나올 0.20버전이 부 버전 업데임에도 불구하고 하위 호완성을 지키지 못할수도 있다. 그러나 캐럿 방식이기 때문에 npm은 0.20 버전은 설치하지 않을 것이다.

## 7. 정리

Node.js 기술을 기반으로 하는 프로트엔드 개발 환경 구축을 위해 Node.js와 NPM을 설치했다. npm init 명령어로 빈 프로젝트를 생성한 뒤 package.json 파일에 프로젝트 정보를 기록했다. 

npm이 제공하는 기본 명령어와 커스텀 명령어를 확인했다. 

프로젝트에서 사용할 외부 모듈을 npm install 명령어로 가져왔고 NPM이 버전을 관리하는 방식에 대해 살펴 보았다.

### 참고
* https://docs.npmjs.com/files/package.json
* https://docs.npmjs.com/misc/semver
* https://blog.outsider.ne.kr/1041
